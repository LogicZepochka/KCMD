libsNames = ["kernel_router.so",
    "init.so",
    "kernel_module.so",
    "net.so",
    "aptclient.so",
    "crypto.so",
    "blockchain.so",
    "metaxploit.so",
    "libhttp.so",
    "libsmtp.so",
    "libsql.so",
    "libftp.so",
    "libssh.so",
    "libchat.so",
    "librshell.so",
    "libcam.so",
    "librepository.so"]
ExploitDB = {}

ExploitDB.ready = true

ExploitDB.prepareDBFolders = function()
    dbFile = get_shell.host_computer.File(Program.path+Program.settings["databasePath"])
    for libName in libsNames
        libFolder = get_shell.host_computer.File(Program.path+Program.settings["databasePath"]+"/"+libName)
        if libFolder == null then get_shell.host_computer.create_folder(Program.path+Program.settings["databasePath"],libName)
    end for
end function

ExploitDB.Init = function()
	
    self.prepareDBFolders
    self.ready = true
end function


ExploitDB.LoadDB = function()
    /// deprecated 
end function

ExploitDB.SaveInDB = function(libName,ver,exploits)
    if not self.ready then return 0
    libFolder = get_shell.host_computer.File(Program.path+Program.settings["databasePath"]+"/"+libName)
    if libFolder == null then get_shell.host_computer.create_folder(Program.path+Program.settings["databasePath"],libName)
    libFolder = get_shell.host_computer.File(Program.path+Program.settings["databasePath"]+"/"+libName)
    verFile = get_shell.host_computer.File(Program.path+Program.settings["databasePath"]+"/"+libName+"/"+ver)
    if verFile == null then get_shell.host_computer.touch(Program.path+Program.settings["databasePath"]+"/"+libName,ver)
    verFile = get_shell.host_computer.File(Program.path+Program.settings["databasePath"]+"/"+libName+"/"+ver)
        
    str = ""
    for mem in exploits.indexes
        str = str + mem + ":"
        for word in exploits[mem]
            str = str + word + "!"
        end for
        str = str[:-1] + char(10)
    end for
    str = str[:-1]
    verFile.set_content(str)
end function

ExploitDB.Request = function(libName,ver)
    if not self.ready then return 0
    libFile = get_shell.host_computer.File(Program.path+Program.settings["databasePath"]+"/"+libName+"/"+ver)
    if libFile == null then 
        UI.printWarning("Нет информации о библиотеке <b>"+libName+"</b> версии <b>"+ver+"</b>")
        return null
    end if
    content = libFile.get_content
    if content == null then return UI.printError("ERROR WHEN LOADING DB","EDB")
    exploits = {}
    for line in content.split(char(10))
        mem = line.split(":")[0]
        exploits[mem] = []
        words = line.split(":")[1]
        for word in words.split("!")
            exploits[mem].push(word)
        end for
    end for

    UI.printWarning("Получена информация из базы данных | <b>"+libName+"</b> версии <b>"+ver+"</b>")
    return exploits
end function

ExploitDB.AddNew = function(lib,ver,mem,word)
    // deprecated 
end function